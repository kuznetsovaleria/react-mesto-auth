{"ast":null,"code":"import{jsxs as _jsxs}from\"react/jsx-runtime\";import{jsx as _jsx}from\"react/jsx-runtime\";import _toConsumableArray from\"/Users/kuznetsovaleria/mesto-react-auth/react-mesto-auth/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _slicedToArray from\"/Users/kuznetsovaleria/mesto-react-auth/react-mesto-auth/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import Header from\"./Header\";import Main from\"./Main\";import Footer from\"./Footer\";import PopupWithForm from\"./PopupWithForm\";import ImagePopup from\"./ImagePopup\";import React from\"react\";import{Redirect,Route,Switch,useHistory}from\"react-router-dom\";import api from\"../api/api\";import EditProfilePopup from\"./EditProfilePopup\";import EditAvatarPopup from\"./EditAvatarPopup\";import AddPlacePopup from\"./AddPlacePopup\";import{CurrentUserContext}from\"../contexts/CurrentUserContext\";import Login from\"./Login\";import Register from\"./Register\";import InfoTooltip from\"./InfoTooltip\";import ProtectedRoute from\"./ProtectedRoute\";import*as auth from\"../auth/auth\";function App(){var _React$useState=React.useState(false),_React$useState2=_slicedToArray(_React$useState,2),loggedIn=_React$useState2[0],setLoggedIn=_React$useState2[1];var _React$useState3=React.useState(\"\"),_React$useState4=_slicedToArray(_React$useState3,2),email=_React$useState4[0],setEmail=_React$useState4[1];var history=useHistory();var _React$useState5=React.useState(false),_React$useState6=_slicedToArray(_React$useState5,2),registerSuccess=_React$useState6[0],setRegisterSuccess=_React$useState6[1];var _React$useState7=React.useState(false),_React$useState8=_slicedToArray(_React$useState7,2),isInfoTooltipPopupOpen=_React$useState8[0],setIsInfoToolPopupOpen=_React$useState8[1];var _React$useState9=React.useState(false),_React$useState10=_slicedToArray(_React$useState9,2),isEditAvatarPopupOpen=_React$useState10[0],setIsEditAvatarPopupOpen=_React$useState10[1];var _React$useState11=React.useState(false),_React$useState12=_slicedToArray(_React$useState11,2),isEditProfilePopupOpen=_React$useState12[0],setIsEditProfilePopupOpen=_React$useState12[1];var _React$useState13=React.useState(false),_React$useState14=_slicedToArray(_React$useState13,2),isAddPlacePopupOpen=_React$useState14[0],setIsAddPlacePopupOpen=_React$useState14[1];var _React$useState15=React.useState(false),_React$useState16=_slicedToArray(_React$useState15,2),isImagePopupOpen=_React$useState16[0],setIsImagePopupOpen=_React$useState16[1];var _React$useState17=React.useState({}),_React$useState18=_slicedToArray(_React$useState17,2),selectedCard=_React$useState18[0],setSelectedCard=_React$useState18[1];var _React$useState19=React.useState({}),_React$useState20=_slicedToArray(_React$useState19,2),currentUser=_React$useState20[0],setCurrentUser=_React$useState20[1];var _React$useState21=React.useState([]),_React$useState22=_slicedToArray(_React$useState21,2),cards=_React$useState22[0],setCards=_React$useState22[1];// ОБРАБОТКА РЕГИСТРАЦИИ\nfunction handleRegister(_ref){var email=_ref.email,password=_ref.password;return auth.register(email,password).then(function(res){if(!res||res.statusCode===400){console.log(\"Что-то пошло не так\");}else{setRegisterSuccess(true);setIsInfoToolPopupOpen(true);history.push(\"/sign-in\");return res;}}).catch(function(err){console.log(err);setIsInfoToolPopupOpen(true);});}// ОБРАБОТКА ЛОГИНА\nfunction handleLogin(_ref2){var email=_ref2.email,password=_ref2.password;return auth.login(email,password).then(function(res){if(!res||res.statusCode===400){console.log(\"Что-то пошло не так\");}if(res.token){setLoggedIn(true);setEmail(email);localStorage.setItem(\"token\",res.token);}}).catch(function(err){console.log(err);});}// ПРОВЕРКА ТОКЕНА\nvar tokenCheck=React.useCallback(function(){var token=localStorage.getItem(\"token\");if(token){auth.checkToken(token).then(function(res){if(res){setLoggedIn(true);setEmail(res.data.email);}history.push(\"/\");}).catch(function(){return history.push(\"/sign-in\");});}},[history]);React.useEffect(function(){tokenCheck();},[tokenCheck]);// ВЫХОД\nfunction handleSignOut(){localStorage.removeItem(\"token\");setLoggedIn(false);history.push(\"/sign-in\");}// ЗАГРУЗКА КАРТОЧЕК И ИНФОРМАЦИИ О ПОЛЬЗОВАТЕЛЕ С СЕРВЕРА\nReact.useEffect(function(){Promise.all([api.getUserData(),api.getInitialCards()]).then(function(_ref3){var _ref4=_slicedToArray(_ref3,2),userData=_ref4[0],cards=_ref4[1];setCurrentUser(userData);setCards(cards);}).catch(function(err){console.log(err);});},[]);//ОТКРЫТЬ РЕДАКТИРОВАНИЕ АВАТАРА\nfunction handleEditAvatarClick(){setIsEditAvatarPopupOpen(true);}// РЕДАКТИРОВАНИЕ АВАТАРА\nfunction handleUpdateAvatar(userAvatar){api.changeUserAvatar({link:userAvatar.avatar}).then(function(userInfo){setCurrentUser(userInfo);closeAllPopups();}).catch(function(err){console.log(err);});}// ОТКРЫТЬ РЕДАКТИРОВАНИЕ ПРОФИЛЯ\nfunction handleEditProfileClick(){setIsEditProfilePopupOpen(true);}// РЕДАКТИРОВАНИЕ ПРОФИЛЯ\nfunction handleUpdateUser(userData){api.editUserInfo(userData).then(function(userInfo){setCurrentUser(userInfo);closeAllPopups();}).catch(function(err){console.log(err);});}// ОТКРЫТЬ ДОБАВЛЕНИЕ КАРТОЧКИ С МЕСТОМ\nfunction handleAddPlaceClick(){setIsAddPlacePopupOpen(true);}// ДОБАВИТЬ КАРТОЧКУ\nfunction handleAddPlaceSubmit(cardData){api.addNewCard(cardData).then(function(newCard){setCards([newCard].concat(_toConsumableArray(cards)));closeAllPopups();}).catch(function(err){console.log(err);});}// ЛАЙК/ДИЗЛАЙК\nfunction handleCardLike(card){var isLiked=card.likes.some(function(i){return i._id===currentUser._id;});var likeRequest=!isLiked?api.putLike(card._id):api.removeLike(card._id);likeRequest.then(function(newCard){var newCards=cards.map(function(c){return c._id===card._id?newCard:c;});setCards(newCards);}).catch(function(err){console.log(err);});}// УДАЛЕНИЕ КАРТОЧКИ\nfunction handleCardDelete(card){api.deleteCard(card._id).then(function(){var newCards=cards.filter(function(c){return c._id!==card._id;});setCards(newCards);}).catch(function(err){console.log(err);});}// ОТКРЫТЬ КАРТИНКУ\nfunction handleCardClick(card){setSelectedCard(card);setIsImagePopupOpen(true);}// ЗАКРЫТЬ ПОПАПЫ\nfunction closeAllPopups(){setIsEditAvatarPopupOpen(false);setIsEditProfilePopupOpen(false);setIsAddPlacePopupOpen(false);setSelectedCard({});setIsImagePopupOpen(false);setIsInfoToolPopupOpen(false);}return/*#__PURE__*/_jsx(\"div\",{className:\"page\",children:/*#__PURE__*/_jsxs(CurrentUserContext.Provider,{value:currentUser,children:[/*#__PURE__*/_jsx(Header,{loggedIn:loggedIn,email:email,onSignOut:handleSignOut}),/*#__PURE__*/_jsxs(Switch,{children:[/*#__PURE__*/_jsx(ProtectedRoute,{exact:true,path:\"/\",component:Main,loggedIn:loggedIn,onEditAvatar:handleEditAvatarClick,onEditProfile:handleEditProfileClick,onAddPlace:handleAddPlaceClick,onCardClick:handleCardClick,cards:cards,onCardLike:handleCardLike,onCardDelete:handleCardDelete}),/*#__PURE__*/_jsx(Route,{path:\"/sign-up\",children:/*#__PURE__*/_jsx(Register,{onRegister:handleRegister})}),/*#__PURE__*/_jsx(Route,{path:\"/sign-in\",children:/*#__PURE__*/_jsx(Login,{onLogin:handleLogin,tokenCheck:tokenCheck})}),/*#__PURE__*/_jsx(Route,{children:loggedIn?/*#__PURE__*/_jsx(Redirect,{to:\"/\"}):/*#__PURE__*/_jsx(Redirect,{to:\"/sign-in\"})})]}),/*#__PURE__*/_jsx(Footer,{}),/*#__PURE__*/_jsx(InfoTooltip,{isOpen:isInfoTooltipPopupOpen,onClose:closeAllPopups,onSuccess:registerSuccess}),/*#__PURE__*/_jsx(EditProfilePopup,{isOpen:isEditProfilePopupOpen,onClose:closeAllPopups,onUpdateUser:handleUpdateUser}),/*#__PURE__*/_jsx(AddPlacePopup,{isOpen:isAddPlacePopupOpen,onClose:closeAllPopups,onAddPlace:handleAddPlaceSubmit}),/*#__PURE__*/_jsx(EditAvatarPopup,{isOpen:isEditAvatarPopupOpen,onClose:closeAllPopups,onUpdateAvatar:handleUpdateAvatar}),/*#__PURE__*/_jsx(PopupWithForm,{title:\"\\u0412\\u044B \\u0443\\u0432\\u0435\\u0440\\u0435\\u043D\\u044B?\",name:\"delete-place\",isOpen:false,onClose:closeAllPopups}),/*#__PURE__*/_jsx(ImagePopup,{card:selectedCard,isOpen:isImagePopupOpen,onClose:closeAllPopups})]})});}export default App;","map":{"version":3,"sources":["/Users/kuznetsovaleria/mesto-react-auth/react-mesto-auth/src/components/App.js"],"names":["Header","Main","Footer","PopupWithForm","ImagePopup","React","Redirect","Route","Switch","useHistory","api","EditProfilePopup","EditAvatarPopup","AddPlacePopup","CurrentUserContext","Login","Register","InfoTooltip","ProtectedRoute","auth","App","useState","loggedIn","setLoggedIn","email","setEmail","history","registerSuccess","setRegisterSuccess","isInfoTooltipPopupOpen","setIsInfoToolPopupOpen","isEditAvatarPopupOpen","setIsEditAvatarPopupOpen","isEditProfilePopupOpen","setIsEditProfilePopupOpen","isAddPlacePopupOpen","setIsAddPlacePopupOpen","isImagePopupOpen","setIsImagePopupOpen","selectedCard","setSelectedCard","currentUser","setCurrentUser","cards","setCards","handleRegister","password","register","then","res","statusCode","console","log","push","catch","err","handleLogin","login","token","localStorage","setItem","tokenCheck","useCallback","getItem","checkToken","data","useEffect","handleSignOut","removeItem","Promise","all","getUserData","getInitialCards","userData","handleEditAvatarClick","handleUpdateAvatar","userAvatar","changeUserAvatar","link","avatar","userInfo","closeAllPopups","handleEditProfileClick","handleUpdateUser","editUserInfo","handleAddPlaceClick","handleAddPlaceSubmit","cardData","addNewCard","newCard","handleCardLike","card","isLiked","likes","some","i","_id","likeRequest","putLike","removeLike","newCards","map","c","handleCardDelete","deleteCard","filter","handleCardClick"],"mappings":"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","sourcesContent":["import Header from \"./Header\";\nimport Main from \"./Main\";\nimport Footer from \"./Footer\";\nimport PopupWithForm from \"./PopupWithForm\";\nimport ImagePopup from \"./ImagePopup\";\nimport React from \"react\";\nimport { Redirect, Route, Switch, useHistory } from \"react-router-dom\";\nimport api from \"../api/api\";\nimport EditProfilePopup from \"./EditProfilePopup\";\nimport EditAvatarPopup from \"./EditAvatarPopup\";\nimport AddPlacePopup from \"./AddPlacePopup\";\nimport { CurrentUserContext } from \"../contexts/CurrentUserContext\";\nimport Login from \"./Login\";\nimport Register from \"./Register\";\nimport InfoTooltip from \"./InfoTooltip\";\nimport ProtectedRoute from \"./ProtectedRoute\";\nimport * as auth from \"../auth/auth\";\n\nfunction App() {\n  const [loggedIn, setLoggedIn] = React.useState(false);\n  const [email, setEmail] = React.useState(\"\");\n  const history = useHistory();\n  const [registerSuccess, setRegisterSuccess] = React.useState(false);\n  const [isInfoTooltipPopupOpen, setIsInfoToolPopupOpen] = React.useState(\n    false\n  );\n  const [isEditAvatarPopupOpen, setIsEditAvatarPopupOpen] = React.useState(\n    false\n  );\n  const [isEditProfilePopupOpen, setIsEditProfilePopupOpen] = React.useState(\n    false\n  );\n  const [isAddPlacePopupOpen, setIsAddPlacePopupOpen] = React.useState(false);\n  const [isImagePopupOpen, setIsImagePopupOpen] = React.useState(false);\n  const [selectedCard, setSelectedCard] = React.useState({});\n  const [currentUser, setCurrentUser] = React.useState({});\n  const [cards, setCards] = React.useState([]);\n\n  // ОБРАБОТКА РЕГИСТРАЦИИ\n  function handleRegister({ email, password }) {\n    return auth\n      .register(email, password)\n      .then((res) => {\n        if (!res || res.statusCode === 400) {\n          console.log(\"Что-то пошло не так\");\n        } else {\n          setRegisterSuccess(true);\n          setIsInfoToolPopupOpen(true);\n          history.push(\"/sign-in\");\n          return res;\n        }\n      })\n      .catch((err) => {\n        console.log(err);\n        setIsInfoToolPopupOpen(true);\n      });\n  }\n\n  // ОБРАБОТКА ЛОГИНА\n  function handleLogin({ email, password }) {\n    return auth\n      .login(email, password)\n      .then((res) => {\n        if (!res || res.statusCode === 400) {\n          console.log(\"Что-то пошло не так\");\n        }\n        if (res.token) {\n          setLoggedIn(true);\n          setEmail(email);\n          localStorage.setItem(\"token\", res.token);\n        }\n      })\n      .catch((err) => {\n        console.log(err);\n      });\n  }\n\n  // ПРОВЕРКА ТОКЕНА\n  const tokenCheck = React.useCallback(() => {\n    const token = localStorage.getItem(\"token\");\n    if (token) {\n      auth\n        .checkToken(token)\n        .then((res) => {\n          if (res) {\n            setLoggedIn(true);\n            setEmail(res.data.email);\n          }\n          history.push(\"/\");\n        })\n        .catch(() => history.push(\"/sign-in\"));\n    }\n  }, [history]);\n\n  React.useEffect(() => {\n    tokenCheck();\n  }, [tokenCheck]);\n\n  // ВЫХОД\n  function handleSignOut() {\n    localStorage.removeItem(\"token\");\n    setLoggedIn(false);\n    history.push(\"/sign-in\");\n  }\n\n  // ЗАГРУЗКА КАРТОЧЕК И ИНФОРМАЦИИ О ПОЛЬЗОВАТЕЛЕ С СЕРВЕРА\n  React.useEffect(() => {\n    Promise.all([api.getUserData(), api.getInitialCards()])\n      .then(([userData, cards]) => {\n        setCurrentUser(userData);\n        setCards(cards);\n      })\n      .catch((err) => {\n        console.log(err);\n      });\n  }, []);\n\n  //ОТКРЫТЬ РЕДАКТИРОВАНИЕ АВАТАРА\n  function handleEditAvatarClick() {\n    setIsEditAvatarPopupOpen(true);\n  }\n\n  // РЕДАКТИРОВАНИЕ АВАТАРА\n  function handleUpdateAvatar(userAvatar) {\n    api\n      .changeUserAvatar({ link: userAvatar.avatar })\n      .then((userInfo) => {\n        setCurrentUser(userInfo);\n        closeAllPopups();\n      })\n      .catch((err) => {\n        console.log(err);\n      });\n  }\n\n  // ОТКРЫТЬ РЕДАКТИРОВАНИЕ ПРОФИЛЯ\n  function handleEditProfileClick() {\n    setIsEditProfilePopupOpen(true);\n  }\n\n  // РЕДАКТИРОВАНИЕ ПРОФИЛЯ\n  function handleUpdateUser(userData) {\n    api\n      .editUserInfo(userData)\n      .then((userInfo) => {\n        setCurrentUser(userInfo);\n        closeAllPopups();\n      })\n      .catch((err) => {\n        console.log(err);\n      });\n  }\n\n  // ОТКРЫТЬ ДОБАВЛЕНИЕ КАРТОЧКИ С МЕСТОМ\n  function handleAddPlaceClick() {\n    setIsAddPlacePopupOpen(true);\n  }\n\n  // ДОБАВИТЬ КАРТОЧКУ\n  function handleAddPlaceSubmit(cardData) {\n    api\n      .addNewCard(cardData)\n      .then((newCard) => {\n        setCards([newCard, ...cards]);\n        closeAllPopups();\n      })\n      .catch((err) => {\n        console.log(err);\n      });\n  }\n\n  // ЛАЙК/ДИЗЛАЙК\n  function handleCardLike(card) {\n    const isLiked = card.likes.some((i) => i._id === currentUser._id);\n    const likeRequest = !isLiked\n      ? api.putLike(card._id)\n      : api.removeLike(card._id);\n\n    likeRequest\n      .then((newCard) => {\n        const newCards = cards.map((c) => (c._id === card._id ? newCard : c));\n        setCards(newCards);\n      })\n      .catch((err) => {\n        console.log(err);\n      });\n  }\n\n  // УДАЛЕНИЕ КАРТОЧКИ\n  function handleCardDelete(card) {\n    api\n      .deleteCard(card._id)\n      .then(() => {\n        const newCards = cards.filter((c) => c._id !== card._id);\n        setCards(newCards);\n      })\n      .catch((err) => {\n        console.log(err);\n      });\n  }\n\n  // ОТКРЫТЬ КАРТИНКУ\n  function handleCardClick(card) {\n    setSelectedCard(card);\n    setIsImagePopupOpen(true);\n  }\n\n  // ЗАКРЫТЬ ПОПАПЫ\n  function closeAllPopups() {\n    setIsEditAvatarPopupOpen(false);\n    setIsEditProfilePopupOpen(false);\n    setIsAddPlacePopupOpen(false);\n    setSelectedCard({});\n    setIsImagePopupOpen(false);\n    setIsInfoToolPopupOpen(false);\n  }\n\n  return (\n    <div className=\"page\">\n      <CurrentUserContext.Provider value={currentUser}>\n        <Header loggedIn={loggedIn} email={email} onSignOut={handleSignOut} />\n        <Switch>\n          <ProtectedRoute\n            exact\n            path=\"/\"\n            component={Main}\n            loggedIn={loggedIn}\n            onEditAvatar={handleEditAvatarClick}\n            onEditProfile={handleEditProfileClick}\n            onAddPlace={handleAddPlaceClick}\n            onCardClick={handleCardClick}\n            cards={cards}\n            onCardLike={handleCardLike}\n            onCardDelete={handleCardDelete}\n          />\n\n          <Route path=\"/sign-up\">\n            <Register onRegister={handleRegister} />\n          </Route>\n\n          <Route path=\"/sign-in\">\n            <Login onLogin={handleLogin} tokenCheck={tokenCheck} />\n          </Route>\n\n          <Route>\n            {loggedIn ? <Redirect to=\"/\" /> : <Redirect to=\"/sign-in\" />}\n          </Route>\n        </Switch>\n\n        <Footer />\n\n        <InfoTooltip\n          isOpen={isInfoTooltipPopupOpen}\n          onClose={closeAllPopups}\n          onSuccess={registerSuccess}\n        />\n\n        <EditProfilePopup\n          isOpen={isEditProfilePopupOpen}\n          onClose={closeAllPopups}\n          onUpdateUser={handleUpdateUser}\n        />\n\n        <AddPlacePopup\n          isOpen={isAddPlacePopupOpen}\n          onClose={closeAllPopups}\n          onAddPlace={handleAddPlaceSubmit}\n        />\n\n        <EditAvatarPopup\n          isOpen={isEditAvatarPopupOpen}\n          onClose={closeAllPopups}\n          onUpdateAvatar={handleUpdateAvatar}\n        />\n\n        <PopupWithForm\n          title=\"Вы уверены?\"\n          name=\"delete-place\"\n          isOpen={false}\n          onClose={closeAllPopups}\n        ></PopupWithForm>\n\n        <ImagePopup\n          card={selectedCard}\n          isOpen={isImagePopupOpen}\n          onClose={closeAllPopups}\n        />\n      </CurrentUserContext.Provider>\n    </div>\n  );\n}\n\nexport default App;\n"]},"metadata":{},"sourceType":"module"}